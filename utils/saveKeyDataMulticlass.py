#!/usr/bin/env python
# coding: utf-8

import os
import pickle
from shutil import Error

from utils.utils import getDataset, save_data_to_file

def saveKeyDataMulticlass(input_path, label_encoder, output_path=None):
    """
        Saves the encoded labels to the dataset that will be used to fit the DL model.
        input_path  :=  str; Balanced Final Train & Test Final sets in ./data/DLvectors/
        label_encoder := obj; the one used to encode the original labels
        output_path :=  str; If none, will overwrite the file from the input path.
    """
    print("\nSaving key data...")
    data = getDataset(input_path, True)
    filename = os.listdir(input_path)[0]    
    y = data[-2]
    encoded_y = label_encoder.transform(y)
    data[-2] = encoded_y
    
    if not output_path:
        # Save as this original pkl file b/c that's what the Keras model will use.
        save_data_to_file(input_path, filename, data)
        print("Saved in " + input_path + '/' + filename)
    else:
        files = os.listdir(output_path)
        files = [f for f in files if f != '.DS_Store']
        if len(files) > 1:
            raise Error("More than 1 file found in %s. Expecting only 1 file so models pull from the intended one." % output_path)
        filename = filename if "DL_Final" in filename else "DL_Final_" + filename
        save_data_to_file(output_path, filename, data)
        print("Saved in " + output_path + '/' + filename)
