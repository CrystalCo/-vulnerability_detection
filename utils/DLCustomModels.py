from keras.models import Sequential
from keras.layers.core import Masking, Dense, Dropout, Activation
from keras.layers.recurrent import GRU
from keras.layers.wrappers import Bidirectional

def create_bgru_model(maxlen=100, units2=2, vector_dim=30, layers=2, dropout=0.1, optimizer='adam'):
    print('\nBuild BGRU Model')
    model = Sequential()
    model.add(Masking(mask_value=0.0, input_shape=(maxlen, vector_dim)))
    for i in range(1, layers):
        model.add(Bidirectional(GRU(units=256, activation='sigmoid', recurrent_activation='hard_sigmoid', return_sequences=True)))
        model.add(Dropout(dropout))
    model.add(Bidirectional(GRU(units=256, activation='sigmoid', recurrent_activation='hard_sigmoid')))
    model.add(Dropout(dropout))
    model.add(Dense(units2, activation='sigmoid'))
    model.compile(loss='categorical_crossentropy', optimizer=optimizer, metrics=['accuracy'])
    model.summary()

    return model
